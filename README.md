# 🎰 ScratchLotteryV2 - 去中心化刮刮樂智能合約

> 一個完全去中心化、基於機率配置的刮刮樂遊戲智能合約。  
> 玩家每天可以多次付費參與抽獎，合約會根據隨機種子與獎池配置發放獎勵。

---

## 🧩 專案簡介

**ScratchLotteryV2** 是一款部署在 EVM 相容鏈（如 Ethereum、Polygon、Conflux、PlatON 等）的「去中心化刮刮樂」智能合約。  
遊戲過程無需第三方信任，獎勵發放、次數限制、機率計算皆由合約自動執行。

- ✅ 去中心化：所有遊戲邏輯在鏈上執行  
- 💰 即時發獎：中獎後自動發送 LAT/ETH  
- 🔒 安全設計：使用 OpenZeppelin 的 `Ownable` 與 `ReentrancyGuard`  
- ⚙️ 管理者可調整獎項與補充獎池資金  

---

## 🧱 合約結構

### 主要功能

| 功能 | 函數名稱 | 權限 | 說明 |
|------|-----------|------|------|
| 玩遊戲 | `play()` | 任意使用者 | 支付固定費用參與抽獎 |
| 補充獎池 | `refill()` | 只有合約擁有者 | 向合約注入資金 |
| 提領餘額 | `withdraw(uint256 amount)` | 只有合約擁有者 | 從獎池提領資金 |
| 設定獎項 | `setPrize(uint8 tier, uint256 amount, uint16 left, uint16 prob)` | 只有合約擁有者 | 調整獎金金額、剩餘數量與中獎權重 |

---

## 🎲 遊戲機制

- 每次遊戲需支付固定 **費用 (FEE = 0.01 ether)**  
- 每位地址每天最多可玩 **30 次**
- 系統使用 `keccak256` 基於玩家地址與時間戳生成隨機種子  
- 獎項共分為 7 級（0~6），其中第 6 級為「謝謝參與」  

### 預設獎項配置

| 等級 | 獎金 (LAT / ETH) | 總數量 | 中獎機率權重 (萬分之一) | 說明 |
|:----:|:----------------:|:------:|:----------------------:|:------|
| 0 | 0.01 | 1000 | 2500 | 小獎 |
| 1 | 0.02 | 500 | 1200 | 小獎 |
| 2 | 0.05 | 100 | 600 | 中獎 |
| 3 | 0.1 | 20 | 120 | 大獎 |
| 4 | 0.2 | 10 | 60 | 超級大獎 |
| 5 | 1 | 1 | 6 | 頭獎 |
| 6 | 0 | 無限 | 4512 | 謝謝參與 |

綜合中獎率約為 **50%**（不含「謝謝參與」）。

---

## 🧮 合約事件 (Events)

| 事件名稱 | 參數 | 說明 |
|-----------|------|------|
| `Play(address player, uint8 prizeTier, uint256 amount, bytes32 txHashUsed)` | 玩家、獎項等級、獎金、隨機種子 | 玩家參與遊戲時觸發 |
| `Refill(address from, uint256 amount)` | 來源地址、金額 | 管理者補充獎池資金 |
| `Withdraw(address to, uint256 amount)` | 提領地址、金額 | 管理者提領資金 |

---


